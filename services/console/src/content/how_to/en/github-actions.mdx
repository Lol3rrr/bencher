---
title: "GitHub Actions"
description: "Use Bencher in GitHub Actions for continuous benchmarking on pull requests"
heading: "How to use Bencher in GitHub Actions"
sortOrder: 3
---

import GitHubActions1 from "../../../chunks/how_to/github-actions.1.mdx";
import GitHubActions2 from "../../../chunks/how_to/github-actions.2.mdx";
import GitHubActions3 from "../../../chunks/how_to/github-actions.3.mdx";
import GitHubActions4 from "../../../chunks/how_to/github-actions.4.mdx";
import GitHubActions5 from "../../../chunks/how_to/github-actions.5.mdx";

A cornerstone of [Statistical Continuous Benchmarking](/docs/how-to/track-benchmarks/#statistical-continuous-benchmarking)
is having a historical baseline for your base branch.
This historical baseline is then used to detect performance regressions in Pull Requests.

Depending on your use case, you can set up [Continuous Benchmarking](/docs/explanation/continuous-benchmarking/) for your:
- Base Branch
- Pull Requests
- Pull Requests from Forks
  <ul>
   <li> ⚠️ Riskier: [Benchmark Fork PR from Target Branch with Required Reviewers](#benchmark-fork-pr-from-target-branch-with-required-reviewers)</li>
   <li> ⛑️ Safer: [Benchmark Fork PR and Upload from Default Branch](#benchmark-fork-pr-and-upload-from-default-branch)</li>
  </ul>

## Base Branch

```yaml
on:
  push:
    branches: main

jobs:
  benchmark_base_branch:
    name: Continuous Benchmarking with Bencher
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: bencherdev/bencher@main
      - name: Track base branch benchmarks with Bencher
        run: |
          bencher run \
          --project save-walter-white-1234abcd
          --token "${{ secrets.BENCHER_API_TOKEN }}" \
          --branch "$GITHUB_REF_NAME" \
          --testbed ubuntu-latest \
          --adapter json
          --err \
          "bencher mock"
```

1. Create a GitHub Actions `workflow` file.
   (ex: `.github/workflows/benchmarks.yml`)
2. Run on `push` events to the `main` branch.
   See the [GitHub Actions `on` documentation](https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#on) for a full overview.
   (ex: `on: push: branches: main`)
3. Create a GitHub Actions `job`.
   (ex: `benchmark_base_branch`)
4. Checkout your base branch source code.
   (ex: `uses: actions/checkout@v4`)
5. Install the Bencher CLI using the [GitHub Action](https://github.com/marketplace/actions/bencher-cli).
   (ex: `uses: bencherdev/bencher@main`)
6. Use the <code><a href="/docs/explanation/bencher-run/">bencher run</a></code> CLI subcommand.
   See [the `bencher run` CLI subcommand](/docs/explanation/bencher-run/) for a full overview.
   (ex: `bencher run`)
7. Set the `--project` option to the Project slug.
   See [the `--project` docs](/docs/explanation/bencher-run/#--project-project) for more details.
   (ex: `--project save-walter-white-1234abcd`)
8. Add `BENCHER_API_TOKEN` as a **Repository** secret and set the `--token` option to this secret.
   Navigate to `Your Repo -> Settings -> Secrets and variables -> Actions -> New repository secret`.
   (ex: `--token ${{ secrets.BENCHER_API_TOKEN }}`)

1.  Set the `--branch` option to the feature Branch name.
   See [branch selection](/docs/explanation/branch-selection/#--branch-branch) for a full overview.
   (ex: `--branch feature-branch`)
2.  Set the `--branch-start-point` option to the feature Branch start point.
   See [branch selection](/docs/explanation/branch-selection/#--branch-start-point-branch) for a full overview.
   (ex: `--branch-start-point main`)
3.  Set the `--branch-start-point-hash` option to the feature Branch start point `git` hash.
   See [branch selection](/docs/explanation/branch-selection/#--branch-start-point-hash-hash) for a full overview.
   (ex: `--branch-start-point-hash 32ae...dd8b`)
4.  Set the `--testbed` option to the Testbed name.
   See [the `--tested` docs](/docs/explanation/bencher-run/#--testbed-testbed) for more details.
   (ex: `--testbed ci-runner`)
5.  Set the `--adapter` option to the desired benchmark harness adapter.
   See [benchmark harness adapters](/docs/explanation/adapters/) for a full overview.
   (ex: `--adapter json`)
6.  Set the `--err` flag to fail the command if an Alert is generated.
   See [Threshold & Alerts](/docs/explanation/thresholds/#alerts) for a full overview.
   (ex: `--err`)
7.  Specify the benchmark command arguments.
   See [benchmark command](/docs/explanation/bencher-run/#benchmark-command) for a full overview.
   (ex: `bencher mock`)



4. The Project must already exist. Set the `--project` flag or the `BENCHER_PROJECT` environment variable to the Project slug or UUID (ex: `BENCHER_PROJECT: save-walter-white`).
5. Optional: Set the `--testbed` flag or the `BENCHER_TESTBED` environment variable to the Testbed slug or UUID.  (ex: `BENCHER_TESTBED: ubuntu-latest`) The Testbed **must** already exist. If this is not set, then the `localhost` Testbed will be used.
6. Optional: Set the `--adapter` flag or the `BENCHER_ADAPTER` environment variable to the desired adapter name.  (ex: `BENCHER_ADAPTER: json`) If this is not set, then the `magic` Adapter will be used. See [benchmark harness adapters](/docs/explanation/adapters/) for a full overview.

9.  [Track your benchmarks](/docs/how-to/track-benchmarks/) with the <code><a href="/docs/explanation/bencher-run/">bencher run</a></code> CLI subcommand:
     1. Optional: Set the `--branch` flag or the `BENCHER_BRANCH` environment variable to the Branch slug or UUID. (ex: `--branch "$GITHUB_REF_NAME"`) This example uses the [GitHub Action default environment variable](https://docs.github.com/en/actions/learn-github-actions/variables#default-environment-variables) `GITHUB_REF_NAME` to select the branch name. The Branch **must** already exist. If this is not set, then the `main` Branch will be used.
    1. The API token must already exist. Add `BENCHER_API_TOKEN` as a **Repository** secret. (ex: `Repo -> Settings -> Secrets and variables -> Actions -> New repository secret`) Set the `--token` flag or the `BENCHER_API_TOKEN` environment variable to the API token. (ex: `--token ${{ secrets.BENCHER_API_TOKEN }}`)
    2.  Set the command to fail if an Alert is generated. (ex: `--err`) In order for an Alert to be generated, a [Threshold](/docs/explanation/thresholds/) must already exist.
    3.  Run your benchmarks and generate a Report from the results. (ex: `"bencher mock"`)

<br/>

## Pull Requests

In order to catch performance regression in Pull Requests, you will need to run your benchmarks on PRs.
If you only expect to have PRs from branches within the **same** repository then you can simply create another workflow to run `on` `pull_request` events from the same repository.

> ⚠️ This solution only works if all PRs are from the **same** repository!
> See [Pull Requests from Forks](#pull-requests-from-forks) below.

<GitHubActions2 />

1. Create a GitHub Actions `workflow` file. (ex: `.github/workflows/pr_benchmarks.yml`)
2. Run on `pull_request` events if and only if the pull request is from the same repository. For handling Fork PRs see [Pull Requests from Forks](#pull-requests-from-forks) below.
3. Set [the permissions for the `GITHUB_TOKEN`](https://docs.github.com/en/actions/using-jobs/assigning-permissions-to-jobs#setting-the-github_token-permissions-for-a-specific-job) to `write` for `pull-requests`. Depending on your GitHub settings, this may not be required. But for all organizations and personal repos [created after 02 Feb 2023](https://github.blog/changelog/2023-02-02-github-actions-updating-the-default-github_token-permissions-to-read-only/), this is the default behavior. See [the GitHub docs](https://docs.github.com/en/actions/security-guides/automatic-token-authentication#modifying-the-permissions-for-the-github_token) for a full overview.
4. [Select the branch](/docs/explanation/branch-selection/) to use:
        1. Use the current branch data if it already exists. (ex: `--if-branch "$GITHUB_REF_NAME"`)
        2. Create a clone of the PR target branch data and thresholds if it already exists. (ex: `--else-if-branch "$GITHUB_BASE_REF"`)
        3. Otherwise, create a clone of the `main` branch data and thresholds. (ex: `--else-if-branch main`)
5. Set the GitHub API authentication token. (ex: `--github-actions "${{ secrets.GITHUB_TOKEN }}"`) When this option is set as a part of a pull request, then the results will be added to the pull request as a comment. This uses [the GitHub Actions `GITHUB_TOKEN` environment variable](https://docs.github.com/en/actions/security-guides/automatic-token-authentication).
6. See the [bencher run](/docs/explanation/bencher-run/) documentation for a full overview of all the ways to configure the pull request comment with the `--ci-*` flags.
7. (Not Shown) Create a second GitHub Actions `workflow` file and use the initial example above to run on `push` events to the `main` branch. (ex: `.github/workflows/benchmarks.yml`)

## Pull Requests from Forks

If you plan to accept pull requests from forks, as is often the case in public open source projects,
then you will need to handle things a little differently.
For security reasons, secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are not available in GitHub Actions for fork PRs.
That is if an external contributor opens up a PR from a fork the above example will not work.
There are two options for fork PRs:

<ul>
  <li> ⚠️ Riskier: [Benchmark Fork PR from Target Branch with Required Reviewers](#benchmark-fork-pr-from-target-branch-with-required-reviewers)</li>
  <li> ⛑️ Safer: [Benchmark Fork PR and Upload from Default Branch](#benchmark-fork-pr-and-upload-from-default-branch)</li>
</ul>

### Benchmark Fork PR from Target Branch with Required Reviewers

> ⚠️ It is **very**, **very** important to thoroughly review every fork PR before approving!
> Not doing so could result in a pwn request!
>
> If you would prefer to not have that hanging over your head, see [Benchmark Fork PR and Upload from Default Branch](#benchmark-fork-pr-and-upload-from-default-branch) below.

<GitHubActions3 />

1. Create a GitHub Actions `workflow` file. (ex: `.github/workflows/pr_benchmarks.yml`)
1. Run [on `pull_request_target` events](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#pull_request_target).
1. Create a `job` named `fork_pr_requires_review` that requires approval from a Required Reviewer before each fork pull request (`external`) run.
1. Create a third `job` that depends on `fork_pr_requires_review`.
   1. Checkout the pull request branch but do not persist the git credentials. (ex: `persist-credentials: false`)
   2. Use single quotes around all untrusted input. (ex: `--if-branch '${{ github.head_ref }}'`)
   3. Pass in all secrets directly. (ex: `--token "${{ secrets.BENCHER_API_TOKEN }}"`)
   4. Run and track your pull request benchmarks with `bencher run`.
1. (Not Shown) Create a second GitHub Actions `workflow` file and use the initial example above to run on `push` events to the `main` branch. (ex: `.github/workflows/benchmarks.yml`)

This setup works because `pull_request_target` runs in the context of the pull request's target branch,
where secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are available.
Therefore, this workflow will only run if it exists on the _target_ branch.

In order to get this configured, you need to [create two GitHub Action Environments](https://docs.github.com/en/actions/deployment/targeting-different-environments/using-environments-for-deployment#using-an-environment)
(ex: `Repo -> Settings -> Environments -> New environment`).
The `internal` environment should have no `Deployment protection rules`.
However, the `external` environment should have `Required reviewers` set to those trusted to review fork PRs before benchmarking. See [this blog post](https://iterative.ai/blog/testing-external-contributions-using-github-actions-secrets) for a full overview.

It is very important to wrap the PR branch name (head ref) in **single** quotes. (ex: `--if-branch '${{ github.head_ref }}'`) Otherwise, an attacker could create a maliciously named branch that performs command injection. See this [GitHub Security Lab write up](https://securitylab.github.com/research/github-actions-untrusted-input/) on preventing pwn requests from untrusted input for a full overview.

Avoid setting any secrets as environment variables, such as `GITHUB_TOKEN` and `BENCHER_API_TOKEN`.
Instead explicitly pass in the secrets to `bencher run`. (ex: `--token "${{ secrets.BENCHER_API_TOKEN }}"`)
See this [GitHub Security Lab write up](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
and [this blog post](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
on preventing pwn requests for a full overview.

### Benchmark Fork PR and Upload from Default Branch

<GitHubActions4 />

1. Create a `Run and Cache Benchmarks` workflow file. (ex: `.github/workflows/pr_benchmarks.yml`)
2. Run all jobs in the workflow on `pull_request` events.
3. Run the benchmarks and save the results to a file. (ex: `benchmark_results.json`)
4. Upload the benchmark results file as an artifact.
5. Upload the `pull_request` event object as an artifact.

<GitHubActions5 />

1. Create a second workflow file, `Track Benchmarks`. (ex: `.github/workflows/track_benchmarks.yml`)
2. Chain `Track Benchmarks` to `Run and Cache Benchmarks` with [the `workflow_run` event](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#workflow_run).
3. Download the cached benchmark results and `pull_request` event.
4. Extract the cached benchmark results and `pull_request` event.
5. Export the necessary data from the `pull_request` event as environment variables.
6. Track the cached benchmark results with `bencher run`:
   1. Use single quotes around all untrusted input. (ex: `--if-branch '${{ env.PR_HEAD }}'`)
   2. Explicitly pass in the pull request number. (ex: `--ci-number '${{ env.PR_NUMBER }}'`)
   3. Pass in the file path to the benchmark results file. (ex: `--file "$BENCHMARK_RESULTS"`)
1. (Not Shown) Create a third GitHub Actions `workflow` file and use the initial example above to run on `push` events to the `main` branch. (ex: `.github/workflows/benchmarks.yml`)

This setup works because `workflow_run` runs in the context of the repository's default branch,
where secrets such as your `BENCHER_API_TOKEN` and the `GITHUB_TOKEN` are available.
Therefore, these workflows will only run if they exist on the _default_ branch.
See [using data from the triggering workflow](https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#using-data-from-the-triggering-workflow) for a full overview.
The pull request number, head branch, and base branch used in the initial workflow must be explicitly passed in since they are not available within `workflow_run`.

It is very important to wrap the PR branch name (head ref) in **single** quotes. (ex: `--if-branch '${{ env.PR_HEAD }}'`) Otherwise, an attacker could create a maliciously named branch that performs command injection. See this [GitHub Security Lab write up](https://securitylab.github.com/research/github-actions-untrusted-input/) on preventing pwn requests from untrusted input for a full overview.

Avoid setting any secrets as environment variables in the `Run and Cache Benchmarks` workflow file.
See this [GitHub Security Lab write up](https://securitylab.github.com/research/github-actions-preventing-pwn-requests/)
and [this blog post](https://nathandavison.com/blog/github-actions-and-the-threat-of-malicious-pull-requests)
on preventing pwn requests for a full overview.

<br/>
<br/>

> 🐰 Congrats! You have learned how to use Bencher in GitHub Actions! 🎉

<br/>

<h2><a href="/docs/explanation/benchmarking/">Keep Going: Benchmarking Overview ➡</a></h2>
