import QueryTimeBefore from "../query-time-before.mdx";
import QueryTimeAfter from "../query-time-after.mdx";

## Дополнение к использованию собственных продуктов в качестве теста

Я уже использую [Bencher для тестирования Bencher][bencher perf],
но все существующие [адаптеры для инструментов бенчмаркинга][adapters] предназначены для микро-бенчмаркинга.
Большинство инструментов для тестирования HTTP представляют собой скорее инструменты для тестирования нагрузки,
и [тестирование нагрузки отличается от бенчмаркинга][continuous benchmarking load testing].
Кроме того, я не планирую в ближайшее время расширять Bencher функционалом тестирования нагрузки.
Это совсем другой случай использования, который потребует совершенно иных архитектурных решений,
например, вот база данных временных рядов.
Даже если бы у меня было тестирование нагрузки,
мне действительно нужно было бы проводить его на свежих данных из продуктивной базы, чтобы это было замечено.
Различия в производительности для этих изменений были незначительны с моей тестовой базой данных.

<details>
    <summary>Нажмите, чтобы просмотреть результаты бенчмарков тестовой базы данных</summary>
    <br />

    До:

    <QueryTimeBefore />

    После добавления индексов и материализованных представлений:

    <QueryTimeAfter />
</details>

<br />

Все это заставляет меня думать, что мне следует создать микро-бенчмарк,
который будет работать с API для измерения производительности и использовать результаты в Bencher.
Это потребует значительной тестовой базы данных,
чтобы убедиться, что такие регрессии производительности будут выявлены в CI.
Я [создал задачу для отслеживания][github issue 367] этой работы, если вы хотите следить за её прогрессом.

Это заставило меня задуматься:
А что если бы можно было делать [тестирование снимками (snapshot testing)][snapshot testing] планов SQL-запросов вашей базы данных?
То есть, вы могли бы сравнивать текущие и потенциальные планы SQL-запросов вашей базы данных.
Тестирование плана SQL-запросов могло бы быть своего рода бенчмаркингом на основе подсчета инструкций для баз данных.
План запроса помогает указать на возможную проблему с производительностью во время выполнения,
не требуя фактического бенчмаркинга SQL-запроса.
Я также [создал задачу для отслеживания][github issue 368] и для этого.
Пожалуйста, не стесняйтесь добавлять комментарий с вашими мыслями или существующими решениями, которые вам известны!

[github issue 367]: https://github.com/bencherdev/bencher/issues/367
[github issue 368]: https://github.com/bencherdev/bencher/issues/368

[bencher perf]: /perf/bencher
[adapters]: /ru/docs/explanation/adapters/
[continuous benchmarking load testing]: /ru/docs/explanation/continuous-benchmarking/#continuous-benchmarking-vs-continuous-load-testing
[snapshot testing]: https://en.wikipedia.org/wiki/Software_testing#Output_comparison_testing